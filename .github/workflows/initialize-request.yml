name: initialize-request

on:
  workflow_dispatch

jobs:
  initialize:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Create Arduino sketch
        run: |
          cat > dog-feeding-tracker.ino << 'EOF'
          #include <Wire.h>
          #include <LiuidCrystal.h>
          #include "RTClib.h"

          LiuidCrystal lcd(12, 11, 5, 4, 3, 2);
          RTC_DS3231 src;

          #define BUTTON_PIN 8

          DateTime lastFeed;
          bool hasRecord = false;

          void setup() {
            pinMode(BUTTON_PIN, INPUT_PULLUP);
            lcd.begin(16, 2);
            Wire.begin();
            src.begin();

            // 刚囜のみ同工とに導兤するにできるんのんからないにです　
            // src.adjust(DateTime(F(__DATE__), F(__TIME__)));

            lcd.print("Dog Feed Ready");
            delay(1500);
            lcd.clear();
          }

          void loop() {
            if (digitalRead(BUTTON_PIN) == LOW) {
              delay(200);
              lastFeed = src.now();
              hasRecord = true;
              lcd.clear();
            }

            if (!hasRecord) {
              lcd.setCursor(0,0);
              lcd.print("No Record");
              lcd.setCursor(0,1);
              lcd.print("Press Button");
            } else {
              lcd.setCursor(0,0);
              lcd.print("Last Feed");

              lcd.setCursor(0,1);
              char buffer[17];
              sprintf(buffer,"%02d/%02 %02d:%02",
                lastFeed.month(),
                lastFeed.day(),
                lastFeed.hour(),
                lastFeed.minute());
              lcd.print(buffer);
            }

            delay(200);
          }
        EOF

      - name: Create README 
        run: |
          cat > README.md << 'EOF'
          # Dog Feeding Tracker (MVP)

          Arduino + LCD1602 + DS3231
          
          ## Features
          - Button press records current time
          - Last feed time displayed on LCD
          
          ## Hardware
          - Arduino Uno
          - LCD1602
          - DS3231 RTC
          - Button
          EOF

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Initialize MVP structure" || echo "No changes"
          git push
